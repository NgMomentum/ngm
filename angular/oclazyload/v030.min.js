/**
 * ocLazyLoad - Load modules on demand (lazy load) with angularJS
 * @version v0.3.0
 * @link https://github.com/ocombe/ocLazyLoad
 * @license MIT
 * @author Olivier Combe <olivier.combe@gmail.com>
 */
!function(){"use strict";function e(e){var n=[];return angular.forEach(e.requires,function(e){-1===l.indexOf(e)&&n.push(e)}),n}function n(e){try{return angular.module(e)}catch(n){if(/No module/.test(n)||n.message.indexOf("$injector:nomod")>-1)return!1}}function r(e){try{return angular.module(e)}catch(n){throw(/No module/.test(n)||n.message.indexOf("$injector:nomod")>-1)&&(n.message='The module "'+e+'" that you are trying to load does not exist. '+n.message),n}}function o(e,n){if(n){var r,o,a,u;for(r=0,o=n.length;o>r;r++)if(a=n[r],angular.isArray(a)){if(!e.hasOwnProperty(a[0]))throw new Error("unsupported provider "+a[0]);u=e[a[0]],t(a[2][0])&&u[a[1]].apply(u,a[2])}}}function a(e,n){if(n){var r,t,i,c=[];for(r=n.length-1;r>=0;r--)t=n[r],"string"!=typeof t&&(t=u(t)),t&&(i=angular.module(t),-1===l.indexOf(t)&&(l.push(t),a(e,i.requires),c=c.concat(i._runBlocks)),o(e,i._invokeQueue),o(e,i._configBlocks),d("ocLazyLoad.moduleLoaded",t),n.pop());var s=e.getInstanceInjector();angular.forEach(c,function(e){s.invoke(e)})}}function t(e){var n=!1;if(angular.isString(e))-1===c.indexOf(e)&&(n=!0,c.push(e),d("ocLazyLoad.componentLoaded",e));else{if(!angular.isObject(e))return!0;angular.forEach(e,function(e){angular.isString(e)&&-1===c.indexOf(e)&&(n=!0,c.push(e))})}return n}function u(e){if(null===e)return null;var n=null;return"string"==typeof e?n=e:"object"==typeof e&&e.hasOwnProperty("name")&&"string"==typeof e.name&&(n=e.name),n}function i(e){function n(e){return e&&a.push(e)}var r,o,a=[e],u=["ng:app","ng-app","x-ng-app","data-ng-app"],i=/\sng[:\-]app(:\s*([\w\d_]+);?)?\s/;angular.forEach(u,function(r){u[r]=!0,n(document.getElementById(r)),r=r.replace(":","\\:"),e.querySelectorAll&&(angular.forEach(e.querySelectorAll("."+r),n),angular.forEach(e.querySelectorAll("."+r+"\\:"),n),angular.forEach(e.querySelectorAll("["+r+"]"),n))}),angular.forEach(a,function(n){if(!r){var a=" "+e.className+" ",t=i.exec(a);t?(r=n,o=(t[2]||"").replace(/\s+/g,",")):angular.forEach(n.attributes,function(e){!r&&u[e.name]&&(r=n,o=e.value)})}}),r&&!function c(e){if(-1===l.indexOf(e)){l.push(e);var n,r,o,a=angular.module(e),u=a._invokeQueue;for(n=0,r=u.length;r>n;n++)o=u[n],angular.isArray(o)&&t(o[2][0]);if(angular.isDefined(a._configBlocks)){var n,r,o,u=a._configBlocks;for(n=0,r=u.length;r>n;n++)o=u[n],angular.isArray(o)&&t(o[2][0])}angular.forEach(a.requires,c)}}(o)}var l=["ng"],c=[],s=[],f=angular.module("oc.lazyLoad",["ng"]),d=angular.noop;f.provider("$ocLazyLoad",["$controllerProvider","$provide","$compileProvider","$filterProvider","$injector","$animateProvider",function(o,t,c,f,g,p){var h,m,v,y={},$=[],E={$controllerProvider:o,$compileProvider:c,$filterProvider:f,$provide:t,$injector:g,$animateProvider:p},j=document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0],L=!1,w=!1;i(angular.element(window.document)),this.$get=["$timeout","$log","$q","$templateCache","$http","$rootElement","$rootScope",function(o,t,i,c,f,g,p){var x;L||(t={},t.error=angular.noop,t.warn=angular.noop),E.getInstanceInjector=function(){return x?x:x=g.data("$injector")},d=function(e,n){w&&p.$broadcast(e,n)};var O=function(e,n){var r,o,a=i.defer();switch(e){case"css":r=document.createElement("link"),r.type="text/css",r.rel="stylesheet",r.href=n;break;case"js":r=document.createElement("script"),r.src=n;break;default:a.reject(new Error('Requested type "'+e+'" is not known. Could not inject "'+n+'"'))}return r.onload=r.onreadystatechange=function(){r.readyState&&!/^c|loade/.test(r.readyState)||o||(r.onload=r.onreadystatechange=null,o=1,-1===s.indexOf(n)&&(s.push(n),d("ocLazyLoad.fileLoaded",n)),a.resolve())},r.onerror=function(){console.log("error"),a.reject(new Error("Unable to load "+n))},r.async=1,j.insertBefore(r,j.lastChild),a.promise};h=h||function(e,n){var r=[];angular.forEach(e,function(e){r.push(O("js",e))}),i.all(r).then(function(){n()},function(e){n(e)})},m=m||function(e,n){var r=[];angular.forEach(e,function(e){r.push(O("css",e))}),i.all(r).then(function(){n()},function(e){n(e)})},v=v||function(e,n,r){angular.isString(e)&&(e=[e]),angular.isFunction(n)&&(r=n,n={}),angular.isUndefined(n)&&(n={});var o=[];return angular.forEach(e,function(e){var r=i.defer();o.push(r.promise),-1===$.indexOf(e)||angular.isDefined(n)&&n.cache===!1?f.get(e,n).success(function(n){angular.forEach(angular.element(n),function(e){"SCRIPT"===e.nodeName&&"text/ng-template"===e.type&&c.put(e.id,e.innerHTML)}),$.push(e),r.resolve()}).error(function(n){var o='Error load template "'+e+'": '+n;t.error(o),r.reject(new Error(o))}):r.resolve()}),i.all(o).then(function(){r()},function(e){r(e)})};var D=function(e,n){var r=[],o=[],a=[],u=[];if(angular.forEach(e,function(e){/\.css[^\.]*$/.test(e)?r.push(e):/\.(htm|html)[^\.]*$/.test(e)?o.push(e):a.push(e)}),r.length>0){var l=i.defer();m(r,function(e){angular.isDefined(e)?(t.error(e),l.reject(e)):l.resolve()}),u.push(l.promise)}if(o.length>0){var c=i.defer();v(o,n,function(e){angular.isDefined(e)?(t.error(e),c.reject(e)):c.resolve()}),u.push(c.promise)}if(a.length>0){var s=i.defer();h(a,function(e){angular.isDefined(e)?(t.error(e),s.reject(e)):s.resolve()}),u.push(s.promise)}return i.all(u)};return{getModuleConfig:function(e){return y[e]?y[e]:null},setModuleConfig:function(e){return y[e.name]=e,e},getModules:function(){return l},loadTemplateFile:function(e,n){return D(e,n)},load:function(c){var s,f,d=this,g=null,p=[],h=[],m=i.defer();if(angular.isArray(c))return angular.forEach(c,function(e){h.push(d.load(e))}),i.all(h).then(function(){m.resolve(c)}),m.promise;if(s=u(c),"string"==typeof c?(g=d.getModuleConfig(c),g||(g={files:[c]},s=null)):"object"==typeof c&&(g=d.setModuleConfig(c)),null===g?(f='Module "'+s+'" is not configured, cannot load.',t.error(f),m.reject(new Error(f))):angular.isDefined(g.template)&&(angular.isUndefined(g.files)&&(g.files=[]),angular.isString(g.template)?g.files.push(g.template):angular.isArray(g.template)&&g.files.concat(g.template)),p.push=function(e){-1===this.indexOf(e)&&Array.prototype.push.apply(this,arguments)},angular.isDefined(s)&&n(s)&&-1!==l.indexOf(s)&&(p.push(s),angular.isUndefined(g.files)))return m.resolve(),m.promise;var v=function y(o){var a,l,c,s=[];if(a=u(o),null===a)return i.when();try{l=r(a)}catch(f){var g=i.defer();return t.error(f.message),g.reject(f),g.promise}return c=e(l),angular.forEach(c,function(e){if("string"==typeof e){var r=d.getModuleConfig(e);if(null===r)return void p.push(e);e=r}return n(e.name)||-1!==p.indexOf(e.name)?void("string"!=typeof o&&t.warn('Module "',a,'" attempted to redefine configuration for dependency "',e.name,'"\nExisting:',d.getModuleConfig(e.name),"Ignored:",e)):("object"==typeof e&&(e.hasOwnProperty("name")&&e.name&&(d.setModuleConfig(e),p.push(e.name)),e.hasOwnProperty("css")&&0!==e.css.length&&angular.forEach(e.css,function(e){O("css",e)})),void(e.hasOwnProperty("files")&&0!==e.files.length&&e.files&&s.push(D(e.files).then(function(){return y(e)}))))}),i.all(s)};return D(g.files).then(function(){null===s?m.resolve(c):(p.push(s),v(s).then(function(){try{a(E,p)}catch(e){return t.error(e.message),void m.reject(e)}o(function(){m.resolve(c)})},function(e){o(function(){m.reject(e)})}))},function(e){m.reject(e)}),m.promise}}}],this.config=function(e){if(h=e.jsLoader||e.asyncLoader,angular.isDefined()&&!angular.isFunction(h))throw"The js loader needs to be a function";if(angular.isDefined(e.cssLoader)&&(m=e.cssLoader),angular.isDefined(e.templatesLoader)&&(v=e.templatesLoader),angular.isDefined(e.loadedModules)){var n=function(e){l.indexOf(e)<0&&(l.push(e),angular.forEach(angular.module(e).requires,n))};angular.forEach(e.loadedModules,n)}angular.isDefined(e.modules)&&(angular.isArray(e.modules)?angular.forEach(e.modules,function(e){y[e.name]=e}):y[e.modules.name]=e.modules),angular.isDefined(e.debug)&&(L=e.debug),angular.isDefined(e.events)&&(w=e.events)}}]),f.directive("ocLazyLoad",["$http","$log","$ocLazyLoad","$compile","$timeout","$templateCache","$animate",function(e,n,r,o,a,t,u){return{restrict:"A",terminal:!0,priority:401,transclude:"element",controller:angular.noop,compile:function(){return function(e,n,o,a,t){function i(){l&&(l.$destroy(),l=null),n.html("")}{var l,c=e.$eval(o.ocLazyLoad);c&&c.onload?c.onload:""}e.$watch(o.ocLazyLoad,function(o){angular.isDefined(o)?r.load(o).then(function(){t(e,function(e){u.enter(e,null,n)})}):i()},!0)}}}}])}();